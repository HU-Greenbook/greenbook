<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Effort Name</title>
    <style>
      html,
      body {
        font-family: sans-serif;
        width: 100vw;
        height: 100vh;
        margin: 0;
        overflow: hidden;
        background: white;
        color: black;
        overflow: hidden;
      }

      #container {
        padding: 0;
        display: flex;
        flex-direction: column;
      }

      #big-division {
        width: 100vw;
        height: 70vh;
        padding: 0 10vw;
        overflow-y: scroll;
      }

      #header>h1 {
        margin-bottom: 5px;
      }

      #header-ps {
        max-height: 25vh;
        overflow-y: hidden;
      }

      #header p {
        width: 80vw;
      }

      #map-view h2 {
        margin: 10px 0;
      }

      #map {
        width: 80%;
        height: 25vh;
      }

      #threed-container {
        height: 70vh;
        width: 100vw;
      }

      #footer {
        width: 100vw;
        height: 15vh;
        padding: 0;
        display: flex;
        flex-direction: row;
        justify-content: center;
        background: black;
        color: white;
        text-align: center;
      }

      #footer>* {
        width: 80%;
      }

      .switch-wrap {
        cursor: pointer;
        background: white;
        padding: 7px;
        width: 80px;
        height: 30px;
        border-radius: 20px;
        margin-bottom: 10px;
        margin: 5px auto;
      }

      .switch-wrap>input {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      .switch {
        height: 100%;
        display: grid;
        grid-template-columns: 0fr 1fr 1fr;
        transition: .2s;
      }

      /*ICYMI, pseudo elements are treated as grid items*/
      .switch::after {
        content: '';
        border-radius: 50%;
        background: #2e9ac1;
        grid-column: 2;
        transition: background .2s;
      }

      input:checked+.switch {
        grid-template-columns: 1fr 1fr 0fr;
      }

      input:checked+.switch::after {
        background-color: #4bc337;
      }

    </style>
    <script src="js/three.js"></script>
    <script src="js/three.doc.js"></script>
    <script src="js/webgl.js"></script>
    <script>
      const addText = (text, font, scene, opts) => {
        const textGeometry = new THREE.TextGeometry(text, {
          font: font,
          size: opts.size || 60,
          height: 5,
          curveSegments: 12,
          bevelEnabled: false,
          bevelThickness: 10,
          bevelSize: 8,
          bevelOffset: 0,
          bevelSegments: 5
        })
        const textMaterial = new THREE.MeshBasicMaterial({
          color: 0x000000
        })
        const textMesh = new THREE.Mesh(
          textGeometry,
          textMaterial
        )
        textMesh.position.x = opts.posX || 0
        textMesh.position.y = opts.posY || 0
        textMesh.position.z = opts.posZ || 0

        // on iOS
        // X goes left(-) right(+)
        // Y goes up(+) down(-)
        // Z goes front(-) back(+)
        textMesh.rotation.x = opts.rotX || 0
        textMesh.rotation.y = opts.rotY || 0
        textMesh.rotation.z = opts.rotZ || 0
        scene.add(textMesh)
        scene.updateMatrixWorld()
      }
      window.addEventListener('load', () => {
        let controls
        let renderer
        let scene
        let camera
        let pivot
        const init = () => {
          camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100)
          controls = new THREE.DeviceOrientationControls(camera)
          scene = new THREE.Scene()
          const geometry = new THREE.SphereBufferGeometry(1000, 60, 40)
          // invert the geometry on the x-axis so that all of the faces point inward
          geometry.scale(-1, 1, 1)
          const material = new THREE.MeshBasicMaterial({
            color: 0x000000
          })
          const mesh = new THREE.Mesh(geometry, material)
          scene.add(mesh)
          const helperGeometry = new THREE.BoxBufferGeometry(100, 100, 100, 4, 4, 4)
          const helperMaterial = new THREE.MeshBasicMaterial({
            color: 0x00ff00,
            wireframe: true
          })
          const helper = new THREE.Mesh(helperGeometry, helperMaterial)
          scene.add(helper)
          const fontLoader = new THREE.FontLoader();
          fontLoader.load('fonts/helvetiker_regular.typeface.json', font => {
            addText('Look around\nfor landmarks', font, scene, {
              posX: -100,
              posZ: -500,
              size: 30
            })
            addText('Hello from\nabove!', font, scene, {
              posY: 500,
              rotX: Math.PI / 2,
              size: 30
            })
            addText('Hello from\nbelow!', font, scene, {
              posY: -500,
              rotX: -Math.PI / 2,
              size: 30
            })
            addText('Bio\nBuilding', font, scene, {
              posX: -700,
              posZ: -350,
              size: 50,
              rotY: Math.PI / 4
            })
            addText('Chapel\nBuilding', font, scene, {
              posX: 300,
              posY: 250,
              size: 80,
              posZ: 500,
              rotY: Math.PI
            })
            addText('Founder\'s\nLibrary', font, scene, {
              posX: -300,
              posY: 350,
              size: 60,
              posZ: 500,
              rotY: 3 * Math.PI / 4
            })
            addText('Physics\nBuilding', font, scene, {
              posX: 700,
              posY: 150,
              posZ: -275,
              size: 100,
              rotY: -Math.PI / 2,
            })
          })
          renderer = new THREE.WebGLRenderer({ antialias: true })
          renderer.setPixelRatio(window.devicePixelRatio)
          renderer.setSize(window.innerWidth, window.innerHeight)
          document.getElementById('threed-container').appendChild(renderer.domElement)
          window.addEventListener('resize', onWindowResize, false)
        }

        const animate = () => {
          window.requestAnimationFrame(animate)
          controls.update()
          renderer.render(scene, camera)
        }

        const onWindowResize = () => {
          camera.aspect = window.innerWidth / window.innerHeight
          camera.updateProjectionMatrix()
          renderer.setSize(window.innerWidth, window.innerHeight)
        }

        document.getElementById('switch')
          .addEventListener('change', async e => {
            if (e.target.checked) {
              document.getElementById('big-division').style.display = 'none'
              document.getElementById('threed-container').style.display = ''
              if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                alert('We\'re about to ask for permission to read your device\'s orientation!')
                const permission = await DeviceOrientationEvent.requestPermission()
                if (permission === 'granted') {
                  //document.getElementById('big-division').style.display = 'none'
                  //document.getElementById('threed-container').style.display = ''
                  init()
                  animate()
                } else {
                  alert('Aw..we need permission for the 3D map to work.')
                }
              } else {
                alert('Your device won\'t let us read its orientation, so the 3D map won\'t work.')
              }
            } else {
              document.getElementById('threed-container').style.display = 'none'
              document.getElementById('big-division').style.display = ''
            }
          })
      })
    </script>
  </head>

  <body>
    <div id="container">
      <div id="threed-container" style="display: none;">
      </div>
      <div id="big-division">
        <div id="header">
          <h1>
            Effort Name
          </h1>
          <div id="header-ps">
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eget lacus risus. Sed libero quam,
              rhoncus quis feugiat in, elementum nec velit. Integer convallis mi vel pellentesque elementum. Duis
              egestas
              aliquam venenatis. Quisque in erat eros. Duis ornare fringilla lacinia. Nulla facilisi. Duis at pulvinar
              lacus.
            </p>
            <p>
              Donec et aliquet sapien. Vivamus urna diam, dictum vel pharetra ac, laoreet id ante. Interdum et malesuada
              fames ac ante ipsum primis in faucibus. Nulla eget finibus metus, eu eleifend turpis. Vivamus nec turpis a
              urna posuere vehicula vitae ac augue. Donec bibendum suscipit pulvinar. Mauris vitae bibendum lacus. Ut
              sit
              amet lacus viverra, suscipit purus ut, imperdiet turpis. Mauris at metus vel felis facilisis lobortis ac
              lobortis ante. Morbi hendrerit, felis eu accumsan dapibus, odio augue vulputate metus, laoreet dictum
              libero
              sapien at enim. Suspendisse tempor suscipit magna, id pellentesque felis porttitor non.
            </p>
          </div>
          <div id="map-view">
            <h2>Map</h2>
            <iframe id="map" frameborder="0" style="border:0"
              src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJfc3I0Py3t4kRodR_MzvI_ho&key=AIzaSyA5bYUvNOQWjOMe39cAAwbyq04ePajnsj4"
              allowfullscreen></iframe>
          </div>
        </div>
      </div>
      <div id="footer">
        <div style="display: flex; flex-direction: column; justify-content: center;">
          <label class="switch-wrap">
            <input id="switch" type="checkbox" />
            <div class="switch"></div>
          </label>
          <span>2D Map</span>
        </div>
      </div>
    </div>
  </body>

</html>
